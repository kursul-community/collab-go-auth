# =============================================================================
# Конфигурация сервиса аутентификации (go-auth)
# =============================================================================

# -----------------------------------------------------------------------------
# Информация о приложении
# -----------------------------------------------------------------------------
app:
  name: "go-auth"
  version: "0.0.1"
  env: "development" # development, staging, production

# -----------------------------------------------------------------------------
# gRPC сервер
# -----------------------------------------------------------------------------
grpc:
  host: "0.0.0.0"
  port: 60051
  timeout: 30 # секунды

# -----------------------------------------------------------------------------
# HTTP REST Gateway
# -----------------------------------------------------------------------------
http:
  host: "0.0.0.0"
  port: 8080
  readTimeout: 30   # секунды
  writeTimeout: 30  # секунды
  idleTimeout: 120  # секунды

# -----------------------------------------------------------------------------
# Логирование
# -----------------------------------------------------------------------------
logger:
  level: "debug" # debug, info, warn, error
  format: "json" # json, text
  output: "stdout" # stdout, file
  filePath: "./logs/app.log"

# -----------------------------------------------------------------------------
# JWT Токены
# -----------------------------------------------------------------------------
token:
  accessTTL: "30m"   # Время жизни access токена
  refreshTTL: "720h" # Время жизни refresh токена (30 дней)

# -----------------------------------------------------------------------------
# Миграции БД
# -----------------------------------------------------------------------------
migrations:
  path: "./migrations"

# -----------------------------------------------------------------------------
# PostgreSQL
# Основные настройки загружаются из переменных окружения:
# PG_USER, PG_PASSWORD, PG_HOST, PG_PORT, PG_DBNAME
# -----------------------------------------------------------------------------
database:
  maxConns: 25           # Максимальное количество соединений в пуле
  minConns: 5            # Минимальное количество соединений в пуле
  connTimeout: "5s"      # Таймаут подключения
  maxConnLifetime: "1h"  # Максимальное время жизни соединения
  maxConnIdleTime: "30m" # Максимальное время простоя соединения
  sslMode: "disable"     # disable, require, verify-ca, verify-full

# -----------------------------------------------------------------------------
# Redis
# Основные настройки загружаются из переменных окружения:
# REDIS_HOST, REDIS_PORT, REDIS_PASSWORD, REDIS_DB
# -----------------------------------------------------------------------------
redis:
  host: "localhost"
  port: 6379
  password: ""
  db: 0
  poolSize: 10           # Размер пула соединений
  minIdleConns: 5        # Минимальное количество idle соединений
  dialTimeout: "5s"      # Таймаут подключения
  readTimeout: "3s"      # Таймаут чтения
  writeTimeout: "3s"     # Таймаут записи

# -----------------------------------------------------------------------------
# SMTP (отправка email)
# -----------------------------------------------------------------------------
smtp:
  host: "smtp.gmail.com"     # SMTP сервер (gmail, yandex, mailgun и др.)
  port: 587                  # Порт (587 для TLS, 465 для SSL, 25 для незащищённого)
  username: ""               # Email отправителя (переопределяется через SMTP_USERNAME)
  password: ""               # Пароль/App Password (переопределяется через SMTP_PASSWORD)
  from: "noreply@example.com" # Адрес отправителя в письмах
  fromName: "Go Auth Service" # Имя отправителя
  useTLS: true               # Использовать TLS
  useSSL: false              # Использовать SSL (для порта 465)
  timeout: "10s"             # Таймаут отправки
  # Настройки шаблонов писем
  templates:
    verificationSubject: "Подтверждение email"
    resetPasswordSubject: "Сброс пароля"
    welcomeSubject: "Добро пожаловать!"

# -----------------------------------------------------------------------------
# Верификация Email
# -----------------------------------------------------------------------------
verification:
  codeLength: 6              # Длина кода верификации
  codeTTL: "15m"             # Время жизни кода
  maxAttempts: 5             # Максимальное количество попыток ввода
  resendCooldown: "60s"      # Задержка между повторными отправками
  linkBaseURL: ""            # Базовый URL для ссылок верификации (если используются ссылки)

# -----------------------------------------------------------------------------
# Безопасность
# -----------------------------------------------------------------------------
security:
  bcryptCost: 12                    # Сложность bcrypt хеширования (10-14 рекомендуется)
  maxLoginAttempts: 5               # Максимальное количество попыток входа
  lockoutDuration: "15m"            # Время блокировки после превышения попыток
  passwordMinLength: 8              # Минимальная длина пароля
  passwordRequireUppercase: true    # Требовать заглавные буквы
  passwordRequireLowercase: true    # Требовать строчные буквы
  passwordRequireDigit: true        # Требовать цифры
  passwordRequireSpecial: false     # Требовать спецсимволы
  sessionMaxAge: "24h"              # Максимальное время сессии
  trustedProxies: []                # Список доверенных прокси

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------
rateLimit:
  enabled: true
  # Глобальные лимиты
  global:
    requestsPerSecond: 100
    burst: 200
  # Лимиты по эндпоинтам
  endpoints:
    login:
      requestsPerMinute: 10
      burst: 5
    register:
      requestsPerMinute: 5
      burst: 3
    resendEmail:
      requestsPerMinute: 3
      burst: 2
    verifyEmail:
      requestsPerMinute: 10
      burst: 5

# -----------------------------------------------------------------------------
# CORS (Cross-Origin Resource Sharing)
# -----------------------------------------------------------------------------
cors:
  enabled: true
  allowedOrigins:
    - "http://localhost:3000"
    - "http://localhost:8080"
  allowedMethods:
    - "GET"
    - "POST"
    - "PUT"
    - "DELETE"
    - "OPTIONS"
  allowedHeaders:
    - "Authorization"
    - "Content-Type"
    - "X-Request-ID"
  exposedHeaders:
    - "X-Request-ID"
  allowCredentials: true
  maxAge: 86400 # секунды (24 часа)

# -----------------------------------------------------------------------------
# Health Check
# -----------------------------------------------------------------------------
health:
  enabled: true
  path: "/health"
  livenessPath: "/health/live"
  readinessPath: "/health/ready"

# -----------------------------------------------------------------------------
# Метрики (Prometheus)
# -----------------------------------------------------------------------------
metrics:
  enabled: false
  path: "/metrics"
  port: 9090
